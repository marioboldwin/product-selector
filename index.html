<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rhode Product URL Selector</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }

  .button-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }

  .product-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 150px;
    padding: 10px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
    border-radius: 6px;
    gap: 6px;
  }

  .product-button img {
    width: 110px;
    height: 110px;
    object-fit: contain;
  }

  .product-button span {
    font-size: 13px;
    text-align: center;
  }

  .product-button.selected {
    border: 2px solid #007BFF;
    background-color: #eef5ff;
  }

  #actionButtons {
    margin-top: 30px;
    text-align: center;
  }

  #actionButtons button {
    margin: 8px;
    padding: 12px 25px;
    font-weight: bold;
    font-size: 16px;
    color: white;
    background-color: #28a745;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #outputContainer {
    margin-top: 20px;
    display: none;
  }

  textarea {
    width: 100%;
    height: 140px;
  }
</style>
</head>

<body>

<h1>Rhode Product URL Selector</h1>

<div class="button-container" id="products"></div>

<div id="actionButtons">
  <button id="selectAll">Select All</button>
  <button id="showSelected">Show Selected URLs</button>
  <button id="clearSelection">Clear Selection</button>
</div>

<div id="outputContainer">
  <h2>Selected URLs</h2>
  <textarea id="output"></textarea><br><br>
  <button id="copyOutput">Copy to Clipboard</button>
</div>

<script>
/* âœ… CORS-SAFE XML SOURCE */
const XML_URL =
  "https://api.allorigins.win/raw?url=https://www.rhodeskin.com/sitemap_products_1.xml";

async function loadProductsFromXML() {
  try {
    const response = await fetch(XML_URL);
    if (!response.ok) throw new Error("XML fetch failed");

    const xmlText = await response.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(xmlText, "application/xml");

    const urls = xml.getElementsByTagName("url");
    const container = document.getElementById("products");

    Array.from(urls).forEach(node => {
      const loc = node.getElementsByTagName("loc")[0]?.textContent;
      const image = node.getElementsByTagName("image:loc")[0]?.textContent;
      const title =
        node.getElementsByTagName("image:title")[0]?.textContent ||
        loc?.split("/products/")[1]?.replace(/-/g, " ");

      if (!loc || !image) return;

      const button = document.createElement("button");
      button.className = "product-button";
      button.dataset.url = loc;

      const img = document.createElement("img");
      img.src = image;
      img.alt = title;

      const label = document.createElement("span");
      label.textContent = title;

      button.appendChild(img);
      button.appendChild(label);

      button.onclick = () => button.classList.toggle("selected");
      container.appendChild(button);
    });
  } catch (err) {
    console.error(err);
    alert("Failed to load products from Rhode sitemap");
  }
}

loadProductsFromXML();

/* ACTION BUTTONS */
document.getElementById("selectAll").onclick = () =>
  document.querySelectorAll(".product-button")
    .forEach(b => b.classList.add("selected"));

document.getElementById("clearSelection").onclick = () => {
  document.querySelectorAll(".product-button")
    .forEach(b => b.classList.remove("selected"));
  document.getElementById("outputContainer").style.display = "none";
};

document.getElementById("showSelected").onclick = () => {
  document.getElementById("output").value =
    [...document.querySelectorAll(".product-button.selected")]
      .map(b => b.dataset.url)
      .join("\n");

  document.getElementById("outputContainer").style.display = "block";
};

document.getElementById("copyOutput").onclick = () => {
  const output = document.getElementById("output");
  output.select();
  document.execCommand("copy");
  alert("Copied!");
};
</script>

</body>
</html>
